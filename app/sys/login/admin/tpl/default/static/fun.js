$(document).ready((function(){function isIE(){var userAgent=navigator.userAgent,isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1,isIE11=userAgent.indexOf("Trident")>-1&&userAgent.indexOf("rv:11.0")>-1;return!!isIE||!!isIE11||void 0}if(isIE()){alert("请不要使用IE或者IE内核的浏览器，可使用Chrome浏览器或者其它浏览器极速模式。");$("body").html("")}if($("#lizitexiao").length>0){particlesJS("lizitexiao",{particles:{number:{value:20,density:{enable:true,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"",width:100,height:100}},opacity:{value:0.5,random:false,anim:{enable:false,speed:1,opacity_min:0.1,sync:false}},size:{value:10,random:true,anim:{enable:false,speed:50,size_min:0.1,sync:false}},line_linked:{enable:true,distance:300,color:"#ffffff",opacity:0.4,width:2},move:{enable:true,speed:8,direction:"none",random:false,straight:false,out_mode:"out",bounce:false,attract:{enable:false,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:false,mode:"repulse"},onclick:{enable:false,mode:"push"},resize:true},modes:{grab:{distance:800,line_linked:{opacity:1}},bubble:{distance:800,size:80,duration:2,opacity:0.8,speed:3},repulse:{distance:400,duration:0.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:true})}}));let getLoginToken=function(){let cookies=document.cookie.split(";");for(let i=0;i<cookies.length;i++){let cookie=cookies[i].split("=");if("LCMSLOGINTOKEN"===cookie[0].trim()){return decodeURIComponent(cookie[1])}}return null};let onAltchaChange;LCMS.util.loading();LCMS.util.tplx("store:login",{openAgree(action,title){LCMS.util.ajax({type:"POST",url:`${LCMS.url.own_form}readme&c=index`,data:{action:action},success:res=>{if(1==res.code){LCMS.util.iframe({title:title,url:`<div class="lcms-editor" style="padding:20px">${res.data}</div>`})}}})},getAltcha(){LCMS.util.ajax({type:"POST",url:LCMS.url.altcha,data:{config:{auto:"onsubmit",floating:"top",floatinganchor:"button.login-btn",onchange:"onAltchaChange"}},success:res=>{if(1==res.code){LCMS.util.tplx("change:dom",(()=>{$(".login-altcha").html(res.data)}))}}})},resetAltcha(){$(".login-altcha .lcms-altcha")[0].reset()},sendCode(opts){LCMS.util.ajax({type:"POST",url:opts.url,data:opts.data,success:res=>{if(1==res.code){layer.prompt({title:"验证码 - 如未收到请联系客服",btn:"立即登录",closeBtn:0,formType:0,maxlength:6,placeholder:"请输入收到的验证码"},((code,layidx)=>{if(code){layer.close(layidx);opts.success&&opts.success(code)}else{LCMS.util.notify({type:"error",content:"请输入验证码"})}}))}else{LCMS.util.notify({type:"error",content:res.msg});opts.error&&opts.error()}}})}});LCMS.util.tplx("login_index",{tabNow:"name",token:"",qrcode:{},reload:{},timer:{},form:{"2fa":0,band:0,go:""},init(){if("band"==LCMS.util.getQuery("action")){this.form.band=1;this.tabNow="band"}if(LCMS.util.getQuery("go")){this.form.go=LCMS.util.getQuery("go")}this.token=getLoginToken();this.$store.login.getAltcha();onAltchaChange=code=>{this.form.code=code};LCMS.util.loading("close")},startTimer(by){if(this.timer[by]&&this.timer[by].inter){return}this.timer[by]={inter:setInterval((()=>{if(this.timer[by].count>=90){this.reload[by]=true;clearInterval(this.timer[by].inter);return}LCMS.util.ajax({type:"GET",url:`${LCMS.url.own_form}ping`,success:res=>{if(1==res.code){window.location.href=res.go}}});this.timer[by].count++}),2000),count:1}},changeTab(by){this.tabNow=by;if("name"==by){return}if(this.qrcode[by]){return}LCMS.util.ajax({type:"GET",url:`${LCMS.url.own_form}qrcode`,data:{action:by},success:res=>{if(1==res.code){this.qrcode[by]=res.data;this.startTimer(by)}else{LCMS.util.notify({type:"error",content:res.msg})}}})},reloadQrcode(by){this.timer[by]={};this.reload[by]=false;this.qrcode[by]=null;this.$nextTick((()=>{this.changeTab(by)}))},async goLogin(e){let{...form}=this.form;const formData=new FormData(e.target);form.name=await LCMS.util.crypto("rsa.encode",{key:this.token,data:formData.get("name")});form.pass=await LCMS.util.crypto("rsa.encode",{key:this.token,data:formData.get("pass")});const postLogin=()=>{LCMS.util.ajax({type:"POST",url:`${LCMS.url.own}n=login&c=index&a=login`,data:form,success:res=>{if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){if("goback"==res.go){window.history.back()}else{window.location.href=res.go}}),1000)}else if(2==res.code){switch(res.go){case"2fa":layer.prompt({title:"两步验证",btn:"立即登录",closeBtn:0,formType:0,maxlength:6,placeholder:"请输入验证码"},((code,layidx)=>{if(code){form["2fa"]=code;postLogin();layer.close(layidx)}else{LCMS.util.notify({type:"error",content:"请输入验证码"})}}));break}}else{LCMS.util.notify({type:"error",content:res.msg});if("reload"==res.go){setTimeout((()=>{window.location.reload()}),1000)}else{this.form.code="";this.$store.login.resetAltcha()}}}})};postLogin()}});LCMS.util.tplx("login_reg",{tabNow:"reg",form:{},init(){this.$store.login.getAltcha();onAltchaChange=code=>{this.form.code=code};LCMS.util.loading("close")},goReg(){let{...form}=this.form;if(form.name.length<6){LCMS.util.notify({type:"error",content:"账号不能少于6位"});return}if(!new RegExp(`^[a-zA-Z0-9_]+$`).test(form.name)){LCMS.util.notify({type:"error",content:"账号只能是字母、数字、下划线"});return}if(!form.vcode){const by=form.email?"email":"mobile";this.$store.login.sendCode({url:`${LCMS.url.own_form}sendcode`,data:{by:by,to:form[by],code:form.code,name:form.name,pass:form.pass,email:form.email,mobile:form.mobile},success:code=>{this.form.vcode=code;this.goReg()},error:()=>{this.form.code="";this.form.vcode="";this.$store.login.resetAltcha()}});return}LCMS.util.ajax({type:"POST",url:`${LCMS.url.own_form}check`,data:form,success:res=>{if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){window.location.href=res.go}),1000)}else{LCMS.util.notify({type:"error",content:res.msg});this.form.code="";this.form.vcode="";this.$store.login.resetAltcha()}}})}});LCMS.util.tplx("login_find",{tabNow:"find",form:{},init(){this.$store.login.getAltcha();onAltchaChange=code=>{this.form.code=code};LCMS.util.loading("close")},goFind(){let{...form}=this.form;if(!form.vcode){const by=form.email?"email":"mobile";this.$store.login.sendCode({url:`${LCMS.url.own_form}sendcode`,data:{by:by,to:form[by],code:form.code},success:code=>{this.form.vcode=code;this.goFind()},error:()=>{this.form.code="";this.form.vcode="";this.$store.login.resetAltcha()}});return}LCMS.util.ajax({type:"POST",url:`${LCMS.url.own_form}check`,data:form,success:res=>{if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){window.location.href=res.go}),1000)}else{LCMS.util.notify({type:"error",content:res.msg});this.form.code="";this.form.vcode="";this.$store.login.resetAltcha()}}})}});LCMS.util.tplx("login_reset",{tabNow:"reset",form:{},init(){LCMS.util.loading("close")},goReset(){let{...form}=this.form;form.token=LCMS.util.getQuery("token");LCMS.util.ajax({type:"POST",url:`${LCMS.url.own_form}reset`,data:form,success:res=>{if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){window.location.href=res.go}),1000)}else{LCMS.util.notify({type:"error",content:res.msg})}}})}});