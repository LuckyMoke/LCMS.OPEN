$(document).ready((function(){if($("#lizitexiao").length>0){particlesJS("lizitexiao",{particles:{number:{value:20,density:{enable:true,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"",width:100,height:100}},opacity:{value:0.5,random:false,anim:{enable:false,speed:1,opacity_min:0.1,sync:false}},size:{value:10,random:true,anim:{enable:false,speed:50,size_min:0.1,sync:false}},line_linked:{enable:true,distance:300,color:"#ffffff",opacity:0.4,width:2},move:{enable:true,speed:8,direction:"none",random:false,straight:false,out_mode:"out",bounce:false,attract:{enable:false,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:false,mode:"repulse"},onclick:{enable:false,mode:"push"},resize:true},modes:{grab:{distance:800,line_linked:{opacity:1}},bubble:{distance:800,size:80,duration:2,opacity:0.8,speed:3},repulse:{distance:400,duration:0.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:true})}if($(".login-readme").length>0){$(".login-readme a").on("click",(function(){var title=$(this).text();LCMS.util.ajax({type:"POST",url:LCMS.url.own_form+"readme&c=index",data:{action:$(this).attr("type")},success:function(res){if(1==res.code){LCMS.util.iframe({title:title,url:'<div class="lcms-editor" style="padding:20px">'+res.data+"</div>"})}}})}))}var qrcheck,showqr=function(name){var qrbox=$(".login-qr-"+name),qrimg=$(".login-qr-"+name+" img"),rfbtn=$(".login-refresh-"+name),pingtest=function(){LCMS.util.ajax({type:"GET",url:LCMS.url.now+"&a=ping",success:function(res){if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){window.location.href=res.go}),1000)}else{qrcheck&&setTimeout((function(){pingtest()}),1000)}}})};if(qrbox.length<=0){return false}var refresh=function(){rfbtn.hide();LCMS.util.ajax({type:"GET",url:qrbox.attr("data-url")+"&name="+name,success:function(res){if(1==res.code){qrimg.attr("src",LCMS.url.qrcode+encodeURIComponent(res.go)).show();qrcheck=true;qrcheck&&pingtest();setTimeout((function(){qrcheck=false;$(".login-refresh").show()}),180*1000)}else{LCMS.util.notify({type:"error",content:"二维码获取失败"})}}})};if(""==qrimg.attr("src")){refresh()}rfbtn.on("click",(function(){refresh()}))};if($(".login-tab").length>0){$(".login-tab a").on("click",(function(){let index=$(this).index(),name=$(this).attr("name");$(".login-tab .active").removeClass("active");$(this).addClass("active");$(".login-body").hide().eq(index).show();showqr(name)}))}$(".login-form form").submit((function(){let url=$(this).attr("action"),query={},getCookie=function(name){let cookies=document.cookie.split(";");for(let i=0;i<cookies.length;i++){let cookie=cookies[i].split("=");if(name===cookie[0].trim()){return decodeURIComponent(cookie[1])}}return null},token=getCookie("LCMSLOGINTOKEN"),istoken=$(this).attr("istoken"),postLogin=function(query){LCMS.util.ajax({type:"POST",url:url,data:query,success:function(res){if(1==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){if("goback"==res.go){window.history.back()}else{window.location.href=res.go}}),1000)}else if(2==res.code){switch(res.go){case"2fa":layer.prompt({title:"两步验证",btn:"立即登录",closeBtn:0,formType:0,maxlength:6,placeholder:"请输入验证码"},(function(value,index,layero){if(value){query["2fa"]=1;query.code=value;postLogin(query);layer.close(index)}else{LCMS.util.notify({type:"error",content:"请输入验证码"})}}));break}}else{LCMS.util.notify({type:"error",content:res.msg});if("reload"==res.go){setTimeout((()=>{window.location.reload()}),1000)}else{$(".login-code input").val("");$(".login-code img").click()}}}})};istoken="true"==istoken?true:false;if(istoken&&!token){LCMS.util.notify({type:"error",content:"缺少签名信息"});setTimeout((()=>{window.location.reload()}),2000);return false}LCMS.util.loading();new Promise((async resolve=>{const form=$(this).serializeArray();for(let i=0;i<form.length;i++){const field=form[i];if(istoken){switch(field.name){case"name":case"pass":field.value=await LCMS.util.crypto("encode",{text:LCMS.util.randStr(8)+field.value,key:token});break}}query[field.name]=field.value}resolve()})).then((()=>{postLogin(query)}));return false}));$(".login-input div").on("click",(function(){var name=$(this).attr("name"),ipts=["name","pass",name],value={};for(var i=0;i<ipts.length;i++){var ipt=$('form input[name="'+ipts[i]+'"]');if(ipt.length>0){if(""==ipt.val()){LCMS.util.notify({type:"error",content:"请输入"+ipt.attr("placeholder")});ipt.focus();return false}if(ipt.val().length<6){LCMS.util.notify({type:"error",content:ipt.attr("placeholder")+"长度不能小于6位"});ipt.focus();return false}if("name"==ipts[i]&&!new RegExp(`^[a-zA-Z0-9_]+$`).test(ipt.val())){LCMS.util.notify({type:"error",content:ipt.attr("placeholder")+"只能是字母、数字、下划线"});ipt.focus();return false}value[ipts[i]]=ipt.val()}}var layindex=layer.open({type:1,title:"请输入验证码",area:["300px","200px"],content:$(".tplcode").html(),success:function(layero,index,that){layero.find(".login-input img").click()}});$(".login-send").on("click",(function(){var code=$(".login-send-code").val();if(!code){LCMS.util.notify({type:"error",content:"请输入验证码"});return false}LCMS.util.ajax({type:"POST",url:$(this).attr("data-url"),data:{action:name,value:value,code:code},success:function(res){if(1==res.code){LCMS.util.notify({content:res.msg})}else{LCMS.util.notify({type:"error",content:res.msg})}},complete:function(){layer.close(layindex)}})}))}))}));