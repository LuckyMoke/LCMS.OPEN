LCMS.plugin.aimodel=Object.assign(LCMS.plugin.aimodel,{request:function(opts){if(!this.apicfg){return false}let data;LCMS.util.EventSource(this.apicfg.api,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({system:opts.system,messages:opts.messages,max_output_tokens:this.apicfg.max_tokens,stream:true}),redirect:"follow",onmessage:function(res){if("[DONE]"!=res.data){data=JSON.parse(res.data);if(data.result){opts.onmessage&&opts.onmessage(data.result)}}},onclose:function(){opts.onclose&&opts.onclose()},onerror:function(error){opts.onerror&&opts.onerror(error);LCMS.util.notify({type:"error",content:error.message})}})}});