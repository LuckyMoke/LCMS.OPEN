LCMS.util.load({src:`${LCMS.url.public}ui/web/static/editor.css`});LCMS.util.tplx("home",{data:{tips:[],apps:[],info:{"服务器系统":"","服务器环境":"","运行环境":"",Opcache:"","PHP扩展":"","开源组件":""},gonggao:`<div class="tplx-loading" style="height:200px"></div>`},appshow:true,loading:true,hoverTimer:null,init(){let info={};for(const name in this.data.info){info[name]=`<div class="tplx-loading" style="height:100%;justify-content:flex-start"></div>`}this.data.info=info;LCMS.util.ajax({type:"GET",url:`${LCMS.url.own_form}data`,success:res=>{if(1==res.code){this.data=res.data;this.loading=false;if(res.data.apps.length<=0){this.appshow=false}if(res.data.update){setTimeout((()=>{this.checkUpdate()}),1000)}if(res.data.phpban){top.layer.alert(`检测到当前PHP版本为${res.data.phpban}，已低于最低版本要求7.3，程序无法正常使用，请立即进行升级！`,{title:"PHP版本太低",closeBtn:0,btn:0,area:"300px"})}}}})},checkUpdate(){let now=Math.round((new Date).getTime()/1000),url=`${LCMS.url.own}t=sys&n=appstore&c=store&a=`,apps=this.data.apps,cache=layui.data("LCMS_cache",{key:"appstore_check_home"}),openLayer=function(data){for(const name in apps){const app=apps[name];if(data[name]&&data[name].ver>app.ver){let index=layer.confirm("检测到新的应用版本，是否更新？",{title:"更新提示",btn:"立即更新"},(function(){layer.close(index);LCMS.plugin.router(`${url}&c=local`)}));return false}}};cache=cache||{};if(!apps||apps.length<=0){return}if(cache.expired>=now){openLayer(cache.data)}else{let applist=[];for(const name in apps){const app=apps[name];applist.push({name:name,ver:app.ver})}LCMS.util.ajax({type:"POST",url:`${url}check&type=index`,data:{applist:JSON.stringify(applist)},layer:true,success:function(res){if(1==res.code){layui.data("LCMS_cache",{key:"appstore_check_home",value:{data:res.data,expired:now+43200}});openLayer(res.data)}}})}},onClick(url){LCMS.plugin.router(url)},onHover(type,app){switch(type){case"enter":if(this.hoverTimer){return}if(app.description){this.hoverTimer=setTimeout((()=>{layer.tips(app.description,this.$el,{tips:[1,"#303133"],time:0})}),500)}break;case"leave":if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null;layer.closeAll("tips")}break}}});