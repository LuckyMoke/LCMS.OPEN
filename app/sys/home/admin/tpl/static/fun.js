let setUrl=function(url){if(self==parent){location.href=url}else{top.LCMS.plugin.router(url)}};LCMS.util.load({src:`${LCMS.url.public}ui/web/static/editor.css`});LCMS.util.tplx("home",{data:{tips:[],apps:[]},appshow:true,mounted(){LCMS.util.ajax({type:"GET",url:`${LCMS.url.own_form}data`,loading:true,success:res=>{if(1==res.code){this.data=res.data;if(res.data.apps.length<=0){this.appshow=false}if(1==res.data.update){setTimeout((()=>{this.checkUpdate()}),1000)}}}})},checkUpdate(){let now=Math.round((new Date).getTime()/1000),url=`${LCMS.url.own}t=sys&n=appstore&c=store&a=`,apps=this.data.apps,cache=layui.data("LCMS_cache",{key:"appstore_check_home"}),openLayer=function(data){for(const name in apps){const app=apps[name];if(data[name]&&data[name].ver>app.ver){let index=layer.confirm("检测到新的应用版本，是否更新？",{title:"更新提示",btn:"立即更新"},(function(){layer.close(index);setUrl(`${url}&c=local`)}));return false}}};cache=cache||{};if(!apps||apps.length<=0){return}if(cache.expired>=now){openLayer(cache.data)}else{let applist=[];for(const name in apps){const app=apps[name];applist.push({name:name,ver:app.ver})}LCMS.util.ajax({type:"POST",url:`${url}check&type=index`,data:{applist:JSON.stringify(applist)},layer:true,success:function(res){if(1==res.code){layui.data("LCMS_cache",{key:"appstore_check_home",value:{data:res.data,expired:now+43200}});openLayer(res.data)}}})}},onClick(url){setUrl(url)},onHover(type,app){switch(type){case"enter":if(app.description){layer.tips(app.description,this.$el,{tips:[1,"#303133"],time:0})}break;case"leave":layer.closeAll("tips");break}}});