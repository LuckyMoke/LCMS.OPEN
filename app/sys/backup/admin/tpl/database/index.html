<template "ui/head" />
<p class="lcms-form-des">▲ 备份数据在<code>/backup/data/</code>目录下，请勿修改文件名称！<br />▲ 恢复数据，请在对应版本的框架下操作！<br />▲ 如果数据量很大，此功能可能无法正常备份，请使用服务器备份！</p>
<ui table($table) />
<script type="text/javascript">
    var backupEach = function (tables, index) {
        if (tables.length - 1 >= index) {
            LCMS.util.notify({
                title: "正在备份（" + (index + 1) + "/" + tables.length + "）",
                content: tables[index]
            });
            LCMS.util.ajax({
                type: "POST",
                url: LCMS.url.own_form + "index&action=backup-table",
                data: {
                    name: tables[index]
                },
                layer: true,
                timeout: 0,
                success: function (res) {
                    if (res.code == 1) {
                        setTimeout(function () {
                            backupEach(tables, index + 1);
                        }, 500);
                    }
                },
            });
        } else {
            LCMS.util.ajax({
                type: "POST",
                url: LCMS.url.own_form + "index&action=backup-ok",
                success: function (res) {
                    if (res.code == 1) {
                        LCMS.util.notify({
                            content: res.msg
                        });
                        setTimeout(function () {
                            window.location.reload();
                        }, 2000);
                    } else {
                        LCMS.util.notify({
                            type: "error",
                            content: res.msg
                        });
                    }
                },
            });
        }
    }, backupDatabase = function (tables) {
        backupEach(tables, 0);
    }
</script>
<template "ui/foot" />