let urlHash=location.search,setUrl=function(url){history.pushState(null,null,"?"+$.base64.encode(url.match(/\?(.*)/)[0]));LBOX.attr("src",url)};if(urlHash&&urlHash.indexOf("&")!=-1){urlHash=urlHash.substring(0,urlHash.indexOf("&"))}urlHash=urlHash.replace("?","");urlHash=$.base64.decode(urlHash).replace("?","");if(urlHash){LBOX.attr("src",LCMS.url.own+urlHash)}else{setUrl($("header .main-menu").attr("data-url"))}if($("header .main-menu a").length>0){$("header .main-menu a").on("click",function(){var url=$(this).attr("data-url");if(url){$("header .main-menu a").removeClass("active");$(this).addClass("active");setUrl(url)}});var menus=$("header .main-menu>ul>li>a");for(let i=0;i<menus.length;i++){$(".main-menu-mobile dl").append("<dd>"+menus[i].outerHTML+"</dd>")}$("header .main-menu-mobile a").on("click",function(){var url=$(this).attr("data-url");url&&setUrl(url)})}if($("body").attr("data-update")==1){urlHash!="t=sys&n=update&c=gitee&a=index"&&setTimeout(function(){var now=Math.round(new Date().getTime()/1000),url=LCMS.url.own+"t=sys&n=update&c=gitee&a=",cache=localStorage.getItem("lcms-update-check"),openLayer=function(code){if(code==1){var index=layer.confirm("检测到新的框架版本，是否更新？",{title:"更新提示",btn:["立即更新","稍后更新"]},function(){setUrl(url+"index");layer.close(index)})}};cache=cache?JSON.parse(cache):"";if(cache&&cache.expired>=now){openLayer(cache.code)}if(!cache||cache.expired<now){LCMS.util.ajax({type:"GET",url:url+"cloud&action=check&type=index",layer:true,success:function(res){localStorage.setItem("lcms-update-check",JSON.stringify({code:res.code==1?1:0,expired:now+86400,}));openLayer(res.code)},})}},1000)}if($(".user-name").length>0){var userName=$(".user-name").attr("data-name"),heartTimer,pageListen=function(){var hidden="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null;document.addEventListener(hidden.replace(/hidden/i,"visibilitychange"),function(){if(!document[hidden]){heartBeat();heartTimer=setInterval(()=>{heartBeat()},10000)}else{clearInterval(heartTimer)}})},heartBeat=function(){LCMS.util.ajax({type:"GET",url:LCMS.url.own_form+"heart&name="+userName,layer:true,success:function(res){if(res.code!=1){top.history.pushState(null,null,"?");top.location.reload()}},})};pageListen();heartTimer=setInterval(()=>{heartBeat()},10000)}