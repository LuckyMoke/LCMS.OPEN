let urlHash=location.search,setUrl=function(url){history.pushState(null,null,"?"+$.base64.encode(url.match(/\?(.*)/)[0]));LBOX.attr("src",url)};if(urlHash&&urlHash.indexOf("&")!=-1){urlHash=urlHash.substring(0,urlHash.indexOf("&"))}urlHash=urlHash.replace("?","");urlHash=$.base64.decode(urlHash).replace("?","");if(urlHash){LBOX.attr("src",LCMS.url.own+urlHash)}else{setUrl($("header .main-menu").attr("data-url"))}if($("header .main-menu a").length>0){$("header .main-menu a").on("click",function(){var url=$(this).attr("data-url");if(url){$("header .main-menu a").removeClass("active");$(this).addClass("active");setUrl(url)}});var menus=$("header .main-menu>ul>li>a");for(let i=0;i<menus.length;i++){$(".main-menu-mobile dl").append("<dd>"+menus[i].outerHTML+"</dd>")}$("header .main-menu-mobile a").on("click",function(){var url=$(this).attr("data-url");url&&setUrl(url)})}if($("body").attr("data-update")==1){setTimeout(function(){var now=Math.round(new Date().getTime()/1000),time=localStorage.getItem("lcms-update"),url=LCMS.url.own+"t=sys&n=update&c=gitee&a=";if(now>time){LCMS.util.ajax({type:"GET",url:url+"cloud&action=index-check",layer:true,success:function(res){if(res.code==1){var index=layer.confirm("检测到新的框架版本，是否更新？",{title:"更新提示",btn:["立即更新","7天不提醒"]},function(){setUrl(url+"index");layer.close(index)},function(){localStorage.setItem("lcms-update",now+7*86400);layer.close(index)})}setTimeout(()=>{localStorage.setItem("lcms-update",now+86400)},8000)},})}},1000)}if($(".user-name").length>0){var uname=$(".user-name").attr("data-name");setInterval(()=>{LCMS.util.ajax({type:"GET",url:LCMS.url.own_form+"heart&name="+uname,layer:true,success:function(res){if(res.code!=1){top.history.pushState(null,null,"?");top.location.reload()}},})},10000)}