if($(".lcms-main-index").length>0){LCMS.plugin.router=function(url,opt){if(url){opt=opt||{};opt.before&&opt.before();let query=url.match(/\?(.*)/),isOwn=-1!==url.indexOf(LCMS.url.site)||-1===url.indexOf("://")?true:false;query=isOwn?$.base64.encode(query[0],true):$.base64.encode(url,true);history.pushState(null,null,`?path=${query}`);LBOX.attr("src",url);if(isOwn){const index=LCMS.util.loading();LBOX.on("load",(function(){LCMS.util.loading("close",index);opt.loaded&&opt.loaded()}))}else{opt.loading&&LCMS.util.loading(opt.loading)}}};let urlHash=LCMS.util.getQuery("path");if(urlHash){urlHash=$.base64.decode(urlHash);try{new URL(urlHash);LCMS.plugin.router(urlHash)}catch(e){urlHash=urlHash.replace("?","");LCMS.plugin.router(LCMS.url.own+urlHash)}}else{LCMS.plugin.router($("header .main-menu").attr("data-url"))}if($("header .main-menu a").length>0){$("header .main-menu a").on("click",(function(){let _this=$(this);LCMS.plugin.router(_this.attr("data-url"),{before:function(){$("header .main-menu a").removeClass("active");_this.addClass("active")}})}));var menus=$("header .main-menu>ul>li>a");for(let i=0;i<menus.length;i++){$(".main-menu-mobile dl").append("<dd>"+menus[i].outerHTML+"</dd>")}$("header .main-menu-mobile a").on("click",(function(){LCMS.plugin.router($(this).attr("data-url"))}))}if(null==urlHash||"n=home"==urlHash){let index_update=function(){if(1!=$("body").attr("data-update")){return false}let now=Math.round((new Date).getTime()/1000),url=`${LCMS.url.own}t=sys&n=update&c=gitee&a=`,cache=layui.data("LCMS_cache",{key:"update_check"}),openLayer=function(code){if(1==code){let index=layer.confirm("检测到新的框架版本，是否更新？",{title:"更新提示",btn:"立即更新"},(function(){LCMS.plugin.router(`${url}index`);layer.close(index)}))}};cache=cache||{};if(cache.expired>=now){openLayer(cache.code)}else{LCMS.util.ajax({type:"GET",url:`${url}cloud&action=check&type=index`,layer:true,success:function(res){layui.data("LCMS_cache",{key:"update_check",value:{code:1==res.code?1:0,expired:now+86400}});openLayer(res.code)}})}};setTimeout((()=>{if(1==$("body").attr("data-async")){LCMS.util.notify({type:"info",content:"数据结构同步中，请勿操作页面！"});LCMS.util.ajax({type:"GET",url:`${LCMS.url.own}t=sys&n=backup&c=repair`,timeout:60000,loading:true,layer:true,success:function(res){if(1==res.code){LCMS.util.ajax({type:"GET",url:`${LCMS.url.own}t=sys&n=index&c=index&a=asynced`,loading:true,layer:true,success:function(){LCMS.util.notify({type:"success",content:"数据结构同步完成"});index_update()}})}else{LCMS.util.notify({type:"error",content:res.msg});index_update()}}})}else{index_update()}}),500)}if($(".sys-notify").length>0){$(".sys-notify ul").on("click","li",(function(){let id=$(this).attr("data-id");LCMS.util.iframe({title:"通知详情",url:`${LCMS.url.admin}index.php?n=index&c=index&a=notify&action=show&id=${id}`,shade:true,shadeClose:true,area:["500px","500px"],end:function(){LCMS.plugin.notify()}})}))}}