<!DOCTYPE html>
    <html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <script type="text/javascript" src="../internal.js"></script>
        <style type="text/css">*{margin:0;padding:0}.txt{box-sizing:border-box;width:90%;height:30px;line-height:21px;border:1px solid #d7d7d7;margin:10px 5% 0 5%;padding:0 10px;outline:0}div{margin:10px 5% 0 5%}</style>
    </head>
    <body>
        <input class="txt" id="text" type="text" disabled="true" placeholder="请输入链接文本" autocomplete="off" />
        <input class="txt" id="href" type="text" placeholder="请输入链接地址" autocomplete="off" />
        <input class="txt" id="title" type="text" placeholder="请输入链接title" autocomplete="off" />
        <div>
            <table style="width:100%">
                <tbody>
                    <tr>
                        <td width="50%"><label for="target">新窗口打开</label> <input id="target" type="checkbox" /></td>
                        <td><label for="nofollow">nofollow</label> <input id="nofollow" type="checkbox" /></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div colspan="2" id="msg"></div>
        <script type="text/javascript">editor.setOpt("allowLinkProtocols",["http:","https:","#","/","ftp:","mailto:","tel:","[area:url]"]);var allowLinkProtocols=editor.getOpt("allowLinkProtocols");var url,orgText,range=editor.selection.getRange(),link=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),text=$G("text"),rangeLink=domUtils.findParentByTagName(range.getCommonAncestor(),"a",true);link=domUtils.findParentByTagName(link,"a",true);if(link){url=utils.html(link.getAttribute("_href")||link.getAttribute("href",2));if(rangeLink===link&&!link.getElementsByTagName("img").length){text.removeAttribute("disabled");orgText=text.value=link[browser.ie?"innerText":"textContent"]}else{text.setAttribute("disabled","true");text.value=lang.validLink}}else if(range.collapsed){text.removeAttribute("disabled");text.value=""}else{text.setAttribute("disabled","true");range.select();var selText=editor.selection.getText();if(""!=selText){text.value=selText}else{text.value=lang.validLink}}$G("title").value=url?link.title:"";$G("href").value=url?url:"";$G("target").checked=url&&"_blank"==link.target?true:false;$G("nofollow").checked=url&&"nofollow"==link.rel?true:false;$focus($G("href"));function handleDialogOk(){var href=$G("href").value.replace(/^\s+|\s+$/g,"");if(href){if(!hrefStartWith(href,allowLinkProtocols)){href="http://"+href}var obj={href:href,target:$G("target").checked?"_blank":"_self",rel:$G("nofollow").checked?"nofollow":"",title:$G("title").value.replace(/^\s+|\s+$/g,""),_href:href};if(orgText&&text.value!=orgText){link[browser.ie?"innerText":"textContent"]=obj.textValue=text.value;range.selectNode(link).select()}if(range.collapsed){obj.textValue=text.value}editor.execCommand("link",utils.clearEmptyAttrs(obj));dialog.close()}}dialog.onok=handleDialogOk;$G("href").onkeydown=$G("title").onkeydown=function(evt){evt=evt||window.event;if(13==evt.keyCode){handleDialogOk();return false}};$G("href").onblur=function(){if(!hrefStartWith(this.value,allowLinkProtocols)){$G("msg").innerHTML="<span style='color: red'>"+lang.httpPrompt+"</span>"}else{$G("msg").innerHTML=""}};function hrefStartWith(href,arr){href=href.replace(/^\s+|\s+$/g,"");for(var ai,i=0;ai=arr[i++];){if(0==href.indexOf(ai)){return true}}return false}</script>
    </body>
    </html>