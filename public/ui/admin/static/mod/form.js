if($(".lcms-form-tips").length>0){$(".lcms-form-tips").each((function(index){var tindex,that=$(this);that.hover((function(){tindex=layer.tips(that.attr("data-tips"),$(this),{tips:[1,"#303133"],time:0})}),(function(){layer.close(tindex)}))}))}if($(".lcms-form-switch").length>0){layui.form.on("switch(lcms-form-switch)",(function(data){var elem=$(data.elem),url=elem.attr("data-url"),timeout=elem.attr("data-timeout");if(url){LCMS.util.ajax({type:"POST",url:url,data:{checked:data.elem.checked?1:""},timeout:timeout,layer:true,success:function(res){if(1==res.code){LCMS.util.notify({content:res.msg});elem.attr("value",res.data?res.data:1)}else{LCMS.util.notify({type:"error",content:res.msg});elem.prop("checked",data.elem.checked?false:true);layui.form.render()}layer.closeAll("tips")}})}}))}layui.form.on("submit(lcmsformsubmit)",(function(lform){var formData=$(lform.form).data();let stripTags=function(html,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");const tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return html.replace(tags,(function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""}))};if("undefined"!=typeof lform.field._lcmsfileinput){delete lform.field._lcmsfileinput}$(lform.form).find(".lcms-form-input").each((function(){const ipt=$(this);lform.field[ipt.attr("name")]=stripTags(ipt.val(),"<span><text><b><i><br>")}));$(lform.form).find(".lcms-form-tags").each((function(){const ipt=$(this).children("input");lform.field[ipt.attr("name")]=stripTags(ipt.val(),"<span><text><b><i><br>")}));$(lform.form).find(".lcms-form-checkbox").each((function(){const ipt=$(this).children("input");ipt.each((function(){lform.field[$(this).attr("name")]=lform.field[$(this).attr("name")]?1:0}))}));$(lform.form).find(".lcms-form-switch").each((function(){const ipt=$(this).children("input");if(lform.field[ipt.attr("name")]){if("1"==lform.field[ipt.attr("name")]){lform.field[ipt.attr("name")]=1}}else{lform.field[ipt.attr("name")]=0}}));$(lform.form).find(".lcms-form-editor").each((function(){var content,editor=$(this).children("div");if(editor.length>0){if("function"==typeof LCMS.plugin.editor.getContent){content=LCMS.plugin.editor.getContent(editor.attr("id"))}else{content=lform.field[$(this).attr("data-name")]}}else{content=$(this).children("script").html()}lform.field[$(this).attr("data-name")]=content?$.base64.encode(content.replace(new RegExp(LCMS.url.site+"upload","g"),"../upload")):""}));var formPost=function(){LCMS.util.ajax({type:"POST",url:lform.form.getAttribute("action"),data:lform.field,timeout:lform.form.getAttribute("timeout"),success:function(res,status,xhr){formData.onsuccess&&LCMS.util.getFun(formData.onsuccess)(res,status,xhr);if(1==res.code){LCMS.util.notify({content:res.msg});const goUrl=function(url){setTimeout((()=>{if($("#LCMS",parent.document).length>0){LCMS.plugin.router(url)}else{window.location.href=url}}),100)};if(res.go){switch(res.go){case"close":setTimeout((function(){LCMS.util.iframe({do:"close",reload:true})}),100);break;case"reload":case"reload-page":goUrl(window.location.href);break;case"reload-parent":setTimeout((function(){parent.window.location.reload()}),100);break;case"reload-top":setTimeout((function(){top.window.location.reload()}),100);break;case"goback":goUrl(document.referrer);break;default:goUrl(res.go);break}}}else if(2==res.code){LCMS.util.notify({content:res.msg});setTimeout((function(){LCMS.util.getFun(res.go)(res.data)}),res.msg?100:1)}else{LCMS.util.notify({type:"error",content:res.msg})}},error:function(xhr,status,error){LCMS.util.notify({type:"error",content:error});formData.onerror&&LCMS.util.getFun(formData.onerror)(xhr,status,error)},complete:function(xhr,status){formData.oncomplete&&LCMS.util.getFun(formData.oncomplete)(xhr,status)}})};if(formData.onsubmit){LCMS.util.getFun(formData.onsubmit)(lform.field,(function(rtn,field){if(true==rtn){if(field){lform.field=field}formPost()}}))}else{formPost()}return false}));