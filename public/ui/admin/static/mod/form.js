if($(".lcms-form-tips").length>0){$(".lcms-form-tips").each(function(index){var that=$(this),tindex;that.hover(function(){tindex=layer.tips(that.attr("data-tips"),$(this),{tips:[1,"#303133"],time:0})},function(){layer.close(tindex)})})}if($(".lcms-form-switch").length>0){layui.form.on("switch(lcms-form-switch)",function(data){var elem=$(data.elem),url=elem.attr("data-url"),timeout=elem.attr("data-timeout");if(url){LCMS.util.ajax({type:"POST",url:url,data:{checked:data.elem.checked?1:""},timeout:timeout,layer:true,success:function(res){if(res.code==1){LCMS.util.notify({content:res.msg});elem.attr("value",res.data?res.data:1)}else{LCMS.util.notify({type:"error",content:res.msg});elem.prop("checked",data.elem.checked?false:true);layui.form.render()}layer.closeAll("tips")},})}})}layui.form.on("submit(lcmsformsubmit)",function(lform){var formData=$(lform.form).data();$(lform.form).find(".lcms-form-input").each(function(){var ipt=$(this);lform.field[ipt.attr("name")]=ipt.val().replace(/'/g,"&#039;").replace(/"/g,"&quot;")});$(lform.form).find(".lcms-form-tags").each(function(){var ipt=$(this).children("input");lform.field[ipt.attr("name")]=ipt.val().replace(/'/g,"&#039;").replace(/"/g,"&quot;")});$(lform.form).find(".lcms-form-checkbox").each(function(){var ipt=$(this).children("input");ipt.each(function(){lform.field[$(this).attr("name")]=lform.field[$(this).attr("name")]?1:0})});$(lform.form).find(".lcms-form-switch").each(function(){var ipt=$(this).children("input");if(lform.field[ipt.attr("name")]){if(lform.field[ipt.attr("name")]=="1"){lform.field[ipt.attr("name")]=1}}else{lform.field[ipt.attr("name")]=0}});$(lform.form).find(".lcms-form-editor").each(function(){var editor=$(this).children("div"),content;if(editor.length>0){if(typeof lcms_editor_getbody=="function"){content=lcms_editor_getbody(editor.attr("id"))}else{content=lform.field[$(this).attr("data-name")]}}else{content=$(this).children("script").html()}lform.field[$(this).attr("data-name")]=content?$.base64.encode(content.replace(new RegExp(LCMS.url.site+"upload","g"),"../upload")):""});var isFunc=function(funcName){try{if(typeof eval(funcName)=="function"){return true}}catch(e){}return false};var formPost=function(){LCMS.util.ajax({type:"POST",url:lform.form.action,data:lform.field,timeout:$(lform.form).attr("timeout"),success:function(res){if(res.code==1){LCMS.util.notify({content:res.msg});if(res.go){switch(res.go){case"close":setTimeout(function(){var tables=$("table.lcms-table",parent.document);if(tables.length>0){tables.each(function(){if($(this).hasClass("lcms-table-tree")){parent.layui.treeTable.reloadData($(this).attr("id"))}else{parent.layui.table.reloadData($(this).attr("id"))}});LCMS.util.iframe({do:"close"})}else{LCMS.util.iframe({do:"close",reload:true})}},1000);break;case"reload":case"reload-page":setTimeout(function(){window.location.reload()},1000);break;case"reload-parent":setTimeout(function(){parent.window.location.reload()},1000);break;case"reload-top":setTimeout(function(){top.window.location.reload()},1000);break;case"goback":setTimeout(function(){window.location.href=document.referrer},1000);break;default:setTimeout(function(){window.location.href=res.go},1000);break}}}else if(res.code==2){LCMS.util.notify({content:res.msg});setTimeout(function(){if(res.go&&isFunc(res.go)){eval(res.go)(res.data)}},res.msg?1000:1)}else{LCMS.util.notify({type:"error",content:res.msg})}},})};if(formData.onsubmit&&isFunc(formData.onsubmit)){eval(formData.onsubmit)(lform.field,function(rtn,field){if(rtn==true){if(field){lform.field=field}formPost()}})}else{formPost()}return false});