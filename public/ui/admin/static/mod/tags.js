layui.extend({inputTags:"inputTags/inputTags"}).use(["inputTags"],(function(){LCMS.plugin.tags={add:function(id,tags){let _this=$(`#${id}`),tpl=`<div><em>{val}</em><button type="button" class="close"><i class="layui-icon layui-icon-close"></i></button></div>`,data=_this.children("input").val(),tbox=_this.children(".lcms-form-tags-box");data=data?data.split("|"):[];tags=tags.replace(/\r\n/g,"\n").replace(/\n/g,"|");tags=tags.split("|");tags||LCMS.util.notify({type:"error",content:"标签不能为空"});for(let i=0;i<tags.length;i++){if(tags[i]&&-1===data.indexOf(tags[i])){tbox.append(LCMS.util.tpl(tpl,{val:tags[i]}));data.push(tags[i])}}_this.children("input").val(data.join("|"));_this.children("textarea").css({display:"block"});_this.children(".lcms-form-tags-button").children("._first").hide()},clear:function(id){let _this=$(`#${id}`);_this.children(".lcms-form-tags-box").html("");_this.children("input").val("");_this.children("textarea").hide();_this.children(".lcms-form-tags-button").children("._first").css({display:"inline-block"})}};$(".lcms-form-tags").each((function(index){top.LCMSUIINDEX++;let _this=$(this),id="LCMSTAGS"+top.LCMSUIINDEX;_this.attr("id",id);_this.children(".lcms-form-tags-box").addClass(`Sortable-${id}`);_this.children(".lcms-form-tags-button").show();if(_this.children("input").val()){_this.children("textarea").css({display:"block"})}else{_this.children(".lcms-form-tags-button").children("._first").css({display:"inline-block"})}layui.inputTags.render({elem:"#"+id});Sortable.create($(`.Sortable-${id}`)[0],{filter:".close",onUpdate:function(){let val=[];_this.children(".lcms-form-tags-box").find("em").text((function(index,content){val[index]=content}));_this.children("input").val(val.join("|"))}})}));$(".lcms-form-tags-button ._first").on("click",(function(){let _this=$(this).parent(".lcms-form-tags-button");$(this).hide();_this.siblings("textarea").css({display:"block"}).focus()}));$(".lcms-form-tags-button ._more").on("click",(function(){let id=$(this).parent(".lcms-form-tags-button").parent(".lcms-form-tags").attr("id");layer.prompt({title:"请输入内容，标签每行一个或以 | 分割",formType:2,maxlength:2000},(function(tags,index){if(tags){LCMS.plugin.tags.add(id,tags);layer.close(index)}}))}));$(".lcms-form-tags-button ._delall").on("click",(function(){let id=$(this).parent(".lcms-form-tags-button").parent(".lcms-form-tags").attr("id"),tips=layer.alert("确认清空所有标签？",(function(){LCMS.plugin.tags.clear(id);layer.close(tips)}))}))}));