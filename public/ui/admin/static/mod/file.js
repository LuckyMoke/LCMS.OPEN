$(".lcms-form-upload-file-btn ._up").each(function(index){top.LCMSUIINDEX++;let up=$(this),id="LCMSUPLOADFILEBTN"+top.LCMSUIINDEX,data=$(this).data(),ipt=$(this).parent(".lcms-form-upload-file-btn").siblings("input"),tpl='<input type="file" accept="'+(data.accept?data.accept:data.mime=="file"?"*":data.mime+"/*")+'" local="'+data.local+'" name="_lcmsfileinput" style="position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:0;">';if(up.siblings("a._box").length>0){ipt.addClass("_2btn")}up.attr("id",id);up.append(tpl);up.on("click","input",function(){let input=$(this);input.off("change").on("change",function(){up.children("._loading").css("display","inline-block");LCMS.plugin.upload.direct({type:"file",file:this.files[0],local:$(input).attr("local")>0?1:0,success:function(res){ipt.val(res.data.original);LCMS.util.notify({content:res.msg})},complete:function(){up.children("._loading").hide();input.remove();up.append(tpl)},})})})});$(".lcms-form-upload-file-btn ._box").on("click",function(){let id=$(this).siblings("a._up").attr("id"),pindex=parent.layer.getFrameIndex(window.name);pindex&&parent.layer.full(pindex);setTimeout(()=>{LCMS.util.iframe({title:"文库",url:`${LCMS.url.own}t=sys&n=upload&c=gallery&a=attachmentlist&id=${id}`+(pindex?`&layerid=${pindex}`:""),shade:true,cancel:function(){pindex&&parent.layer.restore(pindex)},})},pindex?100:0)});