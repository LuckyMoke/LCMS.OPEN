var lcmsTableAjaxAct=function(tableId,Act,defAct){switch(Act){case"close":setTimeout(function(){var tables=$("table.lcms-table",parent.document),trees=$("table.lcms-table-tree",parent.document);if(tables.length>0||trees.length>0){tables.each(function(){parent.layui.table.reloadData($(this).attr("id"))});trees.each(function(){parent.layui.treeGrid.query($(this).attr("id"))});LCMS.util.iframe({do:"close"})}else{LCMS.util.iframe({do:"close",reload:true})}},1000);break;case"reload":setTimeout(function(){layui.table.reloadData(tableId)},1000);break;case"reload-page":setTimeout(function(){window.location.reload()},1000);break;case"reload-parent":setTimeout(function(){parent.window.location.reload()},1000);break;case"reload-top":setTimeout(function(){top.window.location.reload()},1000);break;case"goback":setTimeout(function(){window.location.href=document.referrer},1000);break;default:defAct&&setTimeout(function(){defAct()},1000);break}},lcmsTableAjax=function(tableId,data,arr){LCMS.util.ajax({type:"POST",url:data.url,data:{LC:arr},timeout:data.timeout,success:function(res){if(res.code==1){LCMS.util.notify({content:res.msg});lcmsTableAjaxAct(tableId,res.go)}else if(res.code==2){LCMS.util.notify({content:res.msg});setTimeout(function(){try{eval(res.go)(res.data)}catch(error){}},res.msg?1000:1)}else{res.msg&&LCMS.util.notify({type:"error",content:res.msg})}},})};$(".lcms-table").each(function(index){top.LCMSUIINDEX++;var tableId="LCMSTABLE"+top.LCMSUIINDEX,_this=$(this),data=JSON.parse(_this.attr("data"));if(location.hash){data.page=location.hash.replace("#!lcmstablepage=","")}_this.attr({id:tableId,"lay-filter":tableId});layui.table.render({id:tableId,elem:"#"+tableId,url:data.url,defaultToolbar:data.defaultToolbar,totalRow:data.totalRow,toolbar:data.toolbar,page:{theme:"#409eff",curr:data.page,hash:"lcmstablepage"},limit:data.limit,limits:[20,50,100,300,500,700,1000],cols:[data.cols],even:true,escape:false,done:function(){_this.siblings(".layui-table-view").find(".layui-table-box").css("min-height","auto")},});var toolSelf=_this.siblings(".layui-table-view").find(".layui-table-tool-self");toolSelf.prepend(_this.siblings(".lcms-table-toolbar-search-tpl").html());layui.table.on("toolbar("+tableId+")",function(obj){var data=$(this).data(),checkStatus=layui.table.checkStatus(obj.config.id);switch(obj.event){case"LCMSTABLE_SEARCHOPEN":layer.open({title:"搜索",type:1,shade:0,area:"300px",resize:false,content:toolSelf.find(".lcms-table-toolbar-search-box")});break;case"LCMSTABLE_REFRESH":if(toolSelf.children("form")[0]){toolSelf.children("form")[0].reset()}layui.table.reloadData(tableId,{where:{},page:{theme:"#409eff",curr:1,hash:"lcmstablepage"}});break;case"ajax":if(data.tips){layer.alert(data.tips,{title:"操作数据",area:"120px"},function(){lcmsTableAjax(tableId,data,checkStatus.data)})}else{lcmsTableAjax(tableId,data,checkStatus.data)}break;case"iframe":let area=null;if(data.area){area=data.area.split(",");if(area.length<2){area=area[0]}}LCMS.util.iframe({title:$(this).attr("data-title"),url:data.url,area:area});break;case"href":window.location.href=data.url;break;default:try{eval(obj.event)(obj)}catch(error){}break}});layui.table.on("tool("+tableId+")",function(obj){var data=$(this).data();if(data.url)data.url=data.url.replace(/{id}/g,obj.data.id);switch(obj.event){case"ajax":if(data.tips){layer.alert(data.tips,{title:"操作数据"+(obj.data.id?" [ID:"+obj.data.id+"]":""),area:"120px"},function(){lcmsTableAjax(tableId,data,obj.data)})}else{lcmsTableAjax(tableId,data,obj.data)}break;case"iframe":let area=null;if(data.area){area=data.area.split(",");if(area.length<2){area=area[0]}}LCMS.util.iframe({title:$(this).attr("data-title"),url:data.url+"&id="+obj.data.id,area:area});break;case"href":window.location.href=data.url+"&id="+obj.data.id;break;default:try{eval(obj.event)(obj)}catch(error){}break}});layui.table.on("edit("+tableId+")",function(obj){LCMS.util.ajax({type:"POST",url:data.url+"-save",data:{LC:{id:obj.data.id,name:obj.field,value:obj.value}},success:function(res){if(res.code==1){LCMS.util.notify({content:res.msg});lcmsTableAjaxAct(tableId,res.go)}else{LCMS.util.notify({type:"error",content:res.msg})}},})});layui.form.on("submit(LCMSTABLE_SEARCH)",function(data){layui.table.reloadData(tableId,{where:data.field,page:{theme:"#409eff",curr:1,hash:"lcmstablepage"}});return false});layui.form.on("switch(LCMSTABLE_SWITCH)",function(obj){var elem=$(obj.elem),data=elem.data();if(data.url.length>0){LCMS.util.ajax({type:"POST",url:data.url,data:{LC:{id:LCMS.util.getQuery("id",data.url),name:LCMS.util.getQuery("name",data.url),value:elem.is(":checked")?"1":"0"}},timeout:data.timeout,success:function(res){if(res.code==1){LCMS.util.notify({content:res.msg});lcmsTableAjaxAct(tableId,res.go,function(){if(res.go){window.location.href=res.go}})}else if(res.code==2){LCMS.util.notify({content:res.msg});elem.prop("checked",elem.is(":checked")?false:true);layui.form.render("checkbox");setTimeout(function(){try{eval(res.go)(res.data)}catch(error){}},res.msg?1000:1)}else{res.msg&&LCMS.util.notify({type:"error",content:res.msg});elem.prop("checked",elem.is(":checked")?false:true);layui.form.render("checkbox")}},})}})});if($(".lcms-table-toolbar-date").length>0){$(".lcms-table-toolbar-date").each(function(){var input=$(this).children("input")[0],data=$(input).data();layui.laydate.render({elem:input,trigger:"click",type:data.type?data.type:"date",range:data.range?true:false,min:data.min?data.min:"1900-1-1",max:data.max?data.max:"2099-12-31",calendar:true,theme:"#409eff"})})}$(".lcms-table-box").on({mouseenter:function(){if($(this).children("i.layui-icon").length>0){let title=$(this).attr("data-title");title&&layer.tips(title,$(this),{tips:[1,"#303133"],time:0})}},mouseleave:function(){layer.closeAll("tips")},},"button");